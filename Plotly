import pandas as pd

import plotly.graph_objs as go
import plotly.offline as pyo
df = pd.read_excel(r'C:\Users\shrey\Demo_Excel.xlsx')


#Changing the date format to Month, Year
df['Contract_Start_Date']= df['Contract_Start_Date'].dt.strftime('%m/%Y')

#For Stacked Bar Graph
dfpivot = df.pivot_table(index='Contract_Start_Date',columns = 'Provider_Category',values = 'Provider_Name', aggfunc= 'count')
df.pivot_table(index='Contract_Start_Date',columns = 'Provider_Category',values = 'Provider_Name', aggfunc= 'count').plot.bar(stacked=True)


dfpivot.head()

trace1= go.Bar(x=dfpivot.index,y=dfpivot.Clinic, name ='Clinic')
trace2= go.Bar(x=dfpivot.index,y=dfpivot.Multispeciality, name ='Multispeciality')
trace3= go.Bar(x=dfpivot.index,y=dfpivot.Diagnostic_Centre, name ='Diagnostic Centre')
trace4= go.Bar(x=dfpivot.index,y=dfpivot.Single_Speciality, name ='Single Speciality')

data = [trace1,trace2,trace3,trace4]
layout = go.Layout(title = 'Trial_Stacked_Bar', barmode = 'stack')
figure = go.Figure(data = data, layout = layout)
pyo.plot(figure)

#To create 100% Stack Bar
dfpivotlist =['Clinic','Multispeciality','Diagnostic_Centre','Single_Speciality']
dfpivot['Total'] = dfpivot[dfpivotlist].sum(axis=1)
dfpivotper = dfpivot
dfpivotper.Clinic = dfpivot.Clinic/dfpivot.Total*100
dfpivotper.Multispeciality = dfpivot.Multispeciality/dfpivot.Total*100
dfpivotper.Diagnostic_Centre = dfpivot.Diagnostic_Centre/dfpivot.Total*100
dfpivotper.Single_Speciality = dfpivot.Single_Speciality/dfpivot.Total*100

dfpivotper.head()

trace5= go.Bar(x=dfpivot.index,y=dfpivot.Clinic, name ='Clinic')
trace6= go.Bar(x=dfpivot.index,y=dfpivot.Multispeciality, name ='Multispeciality')
trace7= go.Bar(x=dfpivot.index,y=dfpivot.Diagnostic_Centre, name ='Diagnostic Centre')
trace8= go.Bar(x=dfpivot.index,y=dfpivot.Single_Speciality, name ='Single Speciality')

data = [trace5,trace6,trace7,trace8]
layout = go.Layout(title = 'Trial_100%StackedBar', barmode = 'stack')
figure2 = go.Figure(data = data, layout = layout)
pyo.plot(figure2)
